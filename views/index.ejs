<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WhatsApp Connect ‚Äî Sughosh Technolab</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="bg-bubbles">
      <span></span><span></span><span></span><span></span> <span></span
      ><span></span><span></span><span></span>
    </div>

    <!-- Navbar -->
    <nav class="navbar">
      <div class="nav-brand">
        <div class="brand-icon">
          <svg viewBox="0 0 24 24" fill="currentColor" width="22" height="22">
            <path
              d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"
            />
          </svg>
        </div>
        <!-- <span>Linkora</span> -->
        <div class="brand-text">
          <span class="product-name">Linkora</span>
          <span class="powered-by">Powered by Sughosh Technolab</span>
        </div>
      </div>
      <a href="/history" class="nav-link">
        <svg
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          width="16"
          height="16"
        >
          <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        History
      </a>
    </nav>

    <main class="main-container">
      <div class="hero">
        <div class="hero-badge">
          <span class="pulse-dot"></span>
          Sughosh Technolab ‚Äî Digital Growth Partner
        </div>
        <h1 class="hero-title">
          Reach Anyone on<br />
          <span class="gradient-text">WhatsApp Instantly</span>
        </h1>
        <p class="hero-subtitle">
          Enter any number, select your country, and we'll open WhatsApp with
          your company message pre-filled and ready to send.
        </p>
      </div>

      <!-- Form Card -->
      <div class="card form-card">
        <form action="/send" method="POST" id="sendForm">
          <!-- Country Selector -->
          <div class="form-group full-width">
            <label for="countrySelect">Country</label>
            <div class="custom-select-wrapper">
              <div class="custom-select" id="customSelect">
                <div class="select-trigger" id="selectTrigger">
                  <span class="select-flag" id="selectedFlag">üáÆüá≥</span>
                  <span class="select-name" id="selectedName">India</span>
                  <span class="select-code" id="selectedDialCode">+91</span>
                  <svg
                    class="select-arrow"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2.5"
                    width="14"
                    height="14"
                  >
                    <path d="M6 9l6 6 6-6" />
                  </svg>
                </div>
                <div class="select-dropdown" id="selectDropdown">
                  <div class="select-search-wrap">
                    <svg
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      width="14"
                      height="14"
                    >
                      <circle cx="11" cy="11" r="8" />
                      <path d="M21 21l-4.35-4.35" />
                    </svg>
                    <input
                      type="text"
                      class="select-search"
                      id="countrySearch"
                      placeholder="Search country..."
                    />
                  </div>
                  <div class="select-options" id="selectOptions">
                    <% countries.forEach(function(c) { %>
                    <div
                      class="select-option <%= c.isDefault ? 'selected' : '' %>"
                      data-dial="<%= c.dialCode.replace('-','') %>"
                      data-name="<%= c.name %>"
                      data-flag="<%= getFlagEmoji(c.code) %>"
                    >
                      <span class="opt-flag"><%= getFlagEmoji(c.code) %></span>
                      <span class="opt-name"><%= c.name %></span>
                      <span class="opt-code">+<%= c.dialCode %></span>
                    </div>
                    <% }); %>
                  </div>
                </div>
              </div>
              <input
                type="hidden"
                name="countryCode"
                id="countryCode"
                value="91"
              />
            </div>
          </div>

          <!-- Phone Number -->
          <div class="form-group full-width">
            <label for="phoneNumber">Phone Number</label>
            <div class="input-wrapper">
              <span class="input-prefix-dynamic" id="phonePrefix">+91</span>
              <input
                type="text"
                id="phoneNumber"
                name="phoneNumber"
                placeholder="9876543210"
                required
                autocomplete="off"
                inputmode="numeric"
              />
            </div>
            <span class="field-hint">Enter number without country code</span>
          </div>

          <!-- Where to Connect -->
          <div class="form-group full-width">
            <label for="whereToConnect"
              >Where to Connect
              <span class="label-optional">(optional)</span></label
            >
            <div class="input-wrapper">
              <span class="input-icon">
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  width="16"
                  height="16"
                >
                  <path
                    d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                  />
                  <path d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
              </span>
              <input
                type="text"
                id="whereToConnect"
                name="whereToConnect"
                placeholder="e.g. LinkedIn, Conference, Trade Show..."
                autocomplete="off"
              />
            </div>
            <span class="field-hint"
              >If number already exists, this is appended with a comma</span
            >
          </div>

          <!-- Message Preview -->
          <div class="message-preview">
            <div class="message-preview-header">
              <svg
                viewBox="0 0 24 24"
                fill="currentColor"
                width="13"
                height="13"
              >
                <path
                  d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"
                />
              </svg>
              Pre-filled Message Preview
            </div>
            <div class="message-bubble">
              <pre class="message-text"><%- message %></pre>
              <span class="message-time">Just now ‚úì‚úì</span>
            </div>
          </div>

          <button type="submit" class="btn-submit" id="submitBtn">
            <span class="btn-text">
              <svg
                viewBox="0 0 24 24"
                fill="currentColor"
                width="18"
                height="18"
              >
                <path
                  d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"
                />
              </svg>
              Open WhatsApp
            </span>
            <span class="btn-loader hidden">
              <span class="spinner"></span> Generating link...
            </span>
          </button>
        </form>
      </div>

      <!-- Alerts -->
      <% if (error) { %>
      <div class="alert alert-error">
        <svg
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          width="18"
          height="18"
        >
          <circle cx="12" cy="12" r="10" />
          <line x1="12" y1="8" x2="12" y2="12" />
          <line x1="12" y1="16" x2="12.01" y2="16" />
        </svg>
        <%= error %>
      </div>
      <% } %> <% if (success && waLink) { %>
      <div class="alert alert-success">
        <svg
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          width="18"
          height="18"
        >
          <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <%= success %>
      </div>
      <div class="wa-link-card">
        <div class="wa-link-card-icon">
          <svg viewBox="0 0 24 24" fill="currentColor" width="30" height="30">
            <path
              d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"
            />
          </svg>
        </div>
        <div class="wa-link-content">
          <h3>üéâ Link Ready!</h3>
          <p>
            WhatsApp is opening with your Sughosh Technolab message pre-filled
          </p>
          <a href="<%= waLink %>" target="_blank" class="btn-whatsapp">
            Open in WhatsApp
          </a>
        </div>
      </div>
      <% } %>

      <!-- Recent Contacts -->
      <% if (contacts && contacts.length > 0) { %>
      <div class="card recent-card">
        <div class="section-header">
          <h2>
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              width="18"
              height="18"
            >
              <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            Recent Contacts
          </h2>
          <a href="/history" class="view-all">View All ‚Üí</a>
        </div>
        <div class="contacts-list">
          <% contacts.forEach(function(contact) { %>
          <div class="contact-item">
            <div class="contact-avatar">
              <%= (contact.phoneNumber).slice(-2) %>
            </div>
            <div class="contact-info">
              <span class="contact-number"
                >+<%= contact.countryCode %> <%= contact.phoneNumber %></span
              >
              <% if (contact.whereToConnect) { %>
              <span class="contact-tags">
                <% contact.whereToConnect.split(',').forEach(function(tag) { %>
                <span class="tag"><%= tag.trim() %></span>
                <% }); %>
              </span>
              <% } %>
            </div>
            <a
              href="https://wa.me/<%= contact.countryCode %><%= contact.phoneNumber %>?text=<%= encodeURIComponent(message) %>"
              target="_blank"
              class="contact-action"
              title="Open WhatsApp"
            >
              <svg
                viewBox="0 0 24 24"
                fill="currentColor"
                width="16"
                height="16"
              >
                <path
                  d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"
                />
              </svg>
            </a>
          </div>
          <% }); %>
        </div>
      </div>
      <% } %>
    </main>

    <footer class="footer">
      <p>
        Crafted with ‚ù§Ô∏è by <strong>Sughosh Technolab</strong>
      </p>
    </footer>

    <script>
      // ---- Country flag emoji helper ----
      // (already rendered server-side, just need JS for dynamic select UI)

      const options = document.querySelectorAll('.select-option');
      const trigger = document.getElementById('selectTrigger');
      const dropdown = document.getElementById('selectDropdown');
      const selectedFlag = document.getElementById('selectedFlag');
      const selectedName = document.getElementById('selectedName');
      const selectedDialCode = document.getElementById('selectedDialCode');
      const phonePrefix = document.getElementById('phonePrefix');
      const countryCodeInput = document.getElementById('countryCode');
      const searchInput = document.getElementById('countrySearch');
      const phoneInput = document.getElementById('phoneNumber');

      // Toggle dropdown
      trigger.addEventListener('click', function(e) {
        e.stopPropagation();
        dropdown.classList.toggle('open');
        if (dropdown.classList.contains('open')) {
          searchInput.focus();
          searchInput.value = '';
          filterOptions('');
        }
      });

      // Close on outside click
      document.addEventListener('click', function() {
        dropdown.classList.remove('open');
      });

      dropdown.addEventListener('click', function(e) {
        e.stopPropagation();
      });

      // Search
      searchInput.addEventListener('input', function() {
        filterOptions(this.value.toLowerCase());
      });

      function filterOptions(query) {
        options.forEach(function(opt) {
          const name = opt.dataset.name.toLowerCase();
          const code = opt.dataset.dial;
          opt.style.display = (name.includes(query) || code.includes(query)) ? 'flex' : 'none';
        });
      }

      // Select option
      options.forEach(function(opt) {
        opt.addEventListener('click', function() {
          const dial = this.dataset.dial;
          const name = this.dataset.name;
          const flag = this.dataset.flag;

          selectedFlag.textContent = flag;
          selectedName.textContent = name;
          selectedDialCode.textContent = '+' + dial;
          phonePrefix.textContent = '+' + dial;
          countryCodeInput.value = dial;

          options.forEach(o => o.classList.remove('selected'));
          this.classList.add('selected');
          dropdown.classList.remove('open');

          // Scroll selected into view
          this.scrollIntoView({ block: 'nearest' });
        });
      });

      // Phone input: only allow numbers
      phoneInput.addEventListener('input', function() {
        this.value = this.value.replace(/[^0-9]/g, '');
      });

      // Form submit loader
      const form = document.getElementById('sendForm');
      const submitBtn = document.getElementById('submitBtn');
      form.addEventListener('submit', function() {
        submitBtn.querySelector('.btn-text').classList.add('hidden');
        submitBtn.querySelector('.btn-loader').classList.remove('hidden');
        submitBtn.disabled = true;
      });

      // Auto-open WhatsApp if link is generated
      <% if (waLink) { %>
        setTimeout(function() {
          window.open('<%- waLink %>', '_blank');
        }, 600);
      <% } %>
    </script>
  </body>
</html>
